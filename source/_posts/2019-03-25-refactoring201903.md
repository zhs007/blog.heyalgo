title: 2019年3月工作总结
date: 2019-03-25 16:28:30
tags:
---

## 内核升级到v0.7

- 优化了``MessageID``的实现。
- 增加了更多的请求回调关联，上层代码将更方便的跟踪各种请求。
- 新的测试用例和新的测试用例写法。
- 简化了节点部署流程，新增命令行deamon方式部署。
- 升级了AnkaDB，简化了AnkaDB逻辑代码实现。
- 优化日志输出，INFO级别的日志完全可用。
- ``RoutinePool``优化。
- 移除了前面一组本地协议的冗余实现。
- 支持大文件的传输（grpc协议单个协议最大4mb，用stream方式支持的）。

## 支持双向流

消息流分为3种，分别是单个消息、普通消息流 和 流式消息。  
普通消息流，就是这一组消息可以一起处理，所以会占用内存，等消息结束后一起处理。  
流式消息，目前想到的主要是文件传输，因为如果文件太大，这部分完全可以流式直接处理掉，没必要在内存里收完最后一起处理。  
今天其实做的是普通消息流，流式消息后面再加吧，短期内也没需求。  

因为有些耗时操作，譬如runscript这样的，不是收到request后直接reply的，以前希望通过msgid来把request和reply绑定在一起，特地增加了END来标识结束，今天加了WAITPUSH，想干脆把2种请求分开，如果是异步reply的，先告诉另一端，这样缓存处理简单一些。

双向的异步请求回应都能正常关联上了。  
其实可能还有更复杂的request->reply->request->reply这样的结构，但按道理可以在逻辑层回避掉。  
先不考虑这么多。

现在是一个彻底异步的rpc调用响应了。  

## 节点自动更新

可以通过指令自动更新宿主节点了，终于不用手动更新节点了。  

安全性还是依赖节点的信任系统，而且更新源是本地配置的（HTTPS），感觉应该没啥问题。

